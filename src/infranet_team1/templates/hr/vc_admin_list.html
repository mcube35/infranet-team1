{% extends "base.html" %}

{% block title %}
íœ´ê°€ ê´€ë¦¬ (ê´€ë¦¬ì)
{% endblock %}

{% block content %}
<h1>ğŸ› ï¸ íœ´ê°€ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>

<fieldset style="margin-bottom: 20px;">
    <legend><strong>ì¡°íšŒ ì¡°ê±´</strong></legend>
    <form method="GET" action="{{ url_for('vacation_admin.admin_list') }}">
        <label for="status">ìƒíƒœ:</label>
        <select name="status" id="status" onchange="this.form.submit()">
            <option value="ëŒ€ê¸°" {% if status_filter == 'ëŒ€ê¸°' %}selected{% endif %}>â³ ëŒ€ê¸°</option>
            <option value="ìŠ¹ì¸" {% if status_filter == 'ìŠ¹ì¸' %}selected{% endif %}>âœ… ìŠ¹ì¸</option>
            <option value="ê±°ì ˆ" {% if status_filter == 'ê±°ì ˆ' %}selected{% endif %}>âŒ ê±°ì ˆ</option>
            <option value="ì „ì²´" {% if status_filter == 'ì „ì²´' %}selected{% endif %}>ì „ì²´</option>
        </select>
    </form>
</fieldset>

<table border="1" cellpadding="8" cellspacing="0" style="width:100%; border-collapse: collapse;">
    <thead>
        <tr style="background-color: #f2f2f2;">
            <th>No.</th>
            <th>ì‹ ì²­ì</th>
            <th>íœ´ê°€ ì¢…ë¥˜</th>
            <th>ê¸°ê°„</th>
            <th>ì‹ ì²­ ì‚¬ìœ </th>
            <th>ì‹ ì²­ì¼</th>
            <th>ìƒíƒœ</th>
            <th>ì²˜ë¦¬ ì‚¬ìœ  / ì²˜ë¦¬ì</th>
            <th>ì¡°ì¹˜</th>
        </tr>
    </thead>
    <tbody>
        {% if vacations %}
            {% for vacation in vacations %}
            <tr>
                <td style="text-align: center;">
                    {{ total_records - ((current_page - 1) * page_size) - loop.index0 }}
                </td>
                <td style="text-align: center;">
                    {% if vacation.user_info and vacation.user_info|length > 0 %}
                        {{ vacation.user_info[0].name }}
                    {% else %}
                        (ì•Œ ìˆ˜ ì—†ìŒ)
                    {% endif %}
                </td>
                <td style="text-align: center;">
                    {{ vacation.vacation_type }}
                </td>
                <td style="text-align: center;">
                    {{ vacation.start_date }} ~ {{ vacation.end_date }}
                </td>
                <td>
                    {{ vacation.reason }}
                </td>
                <td style="text-align: center;">
                    {{ vacation.created_at.strftime('%Y-%m-%d %H:%M') if vacation.created_at else '-' }}
                </td>
                <td style="text-align: center;">
                    {% if vacation.status == 'ìŠ¹ì¸' %}
                        <strong style="color: green;">âœ… ìŠ¹ì¸</strong>
                    {% elif vacation.status == 'ëŒ€ê¸°' %}
                        <strong style="color: orange;">â³ ëŒ€ê¸°</strong>
                    {% elif vacation.status == 'ê±°ì ˆ' %}
                        <strong style="color: red;">âŒ ê±°ì ˆ</strong>
                    {% endif %}
                </td>
                <td style="text-align: center;">
                    {% if vacation.status == 'ê±°ì ˆ' and vacation.rejection_reason %}
                        <span style="color: red;">{{ vacation.rejection_reason }}</span><br>
                        <small>({{ vacation.processed_by_name }})</small>
                    {% elif vacation.status == 'ìŠ¹ì¸' %}
                        - <br>
                        <small>({{ vacation.processed_by_name }})</small>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td style="text-align: center;">
                    {% if vacation.status == 'ëŒ€ê¸°' %}
                        <form action="{{ url_for('vacation_admin.approve_vacation', vacation_id=vacation._id) }}" method="post" style="display: inline;">
                            <button type="submit" title="ìŠ¹ì¸" onclick="return confirm('ì´ íœ´ê°€ ì‹ ì²­ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" style="background:none; border:none; cursor:pointer; font-size:1.2em;">ğŸ‘</button>
                        </form>
                        <form action="{{ url_for('vacation_admin.reject_vacation', vacation_id=vacation._id) }}" method="post" style="display: inline; margin-left: 10px;">
                            <input type="hidden" name="rejection_reason" value="">
                            <button type="submit" title="ê±°ì ˆ" onclick="return handleReject(this.form);" style="background:none; border:none; cursor:pointer; font-size:1.2em;">ğŸ‘</button>
                        </form>
                    {% elif vacation.status in ['ìŠ¹ì¸', 'ê±°ì ˆ'] %}
                        <form action="{{ url_for('vacation_admin.revert_vacation_status', vacation_id=vacation._id) }}" method="post" style="display: inline;">
                            <button type="submit" title="ì²˜ë¦¬ ì·¨ì†Œ (ëŒ€ê¸° ìƒíƒœë¡œ ë³€ê²½)" onclick="return confirm('ì´ íœ´ê°€ì˜ ì²˜ë¦¬ë¥¼ ì·¨ì†Œí•˜ê³  \'ëŒ€ê¸°\' ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ? \n(ìŠ¹ì¸ëœ ì—°ì°¨ì˜ ê²½ìš°, ì‚¬ìš©ì¼ìˆ˜ ê³„ì‚°ì´ ìë™ìœ¼ë¡œ ë³µêµ¬ë©ë‹ˆë‹¤)');" style="background:none; border:none; cursor:pointer; font-size:1.2em;">ğŸ”„</button>
                        </form>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="9" style="text-align: center; padding: 20px;">
                    í•´ë‹¹ ìƒíƒœì˜ íœ´ê°€ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
            </tr>
        {% endif %}
    </tbody>
</table>

<div class="pagination" style="text-align: center; margin-top: 20px;">
    {% if total_pages > 0 %}
        {% if current_page > 1 %}
            <a href="{{ url_for('vacation_admin.admin_list', page=current_page - 1, status=status_filter) }}" style="text-decoration: none; padding: 5px;">Â« ì´ì „</a>
        {% else %}
            <span style="color: grey; padding: 5px;">Â« ì´ì „</span>
        {% endif %}
        {% for page_num in range(1, total_pages + 1) %}
            {% if page_num == current_page %}
                <strong style="padding: 5px; color: black;">{{ page_num }}</strong>
            {% else %}
                <a href="{{ url_for('vacation_admin.admin_list', page=page_num, status=status_filter) }}" style="text-decoration: none; padding: 5px;">{{ page_num }}</a>
            {% endif %}
        {% endfor %}
        {% if current_page < total_pages %}
            <a href="{{ url_for('vacation_admin.admin_list', page=current_page + 1, status=status_filter) }}" style="text-decoration: none; padding: 5px;">ë‹¤ìŒ Â»</a>
        {% else %}
            <span style="color: grey; padding: 5px;">ë‹¤ìŒ Â»</span>
        {% endif %}
    {% endif %}
</div>

<script>
function handleReject(form) {
    const reason = prompt("íœ´ê°€ ì‹ ì²­ì„ ê±°ì ˆí•˜ëŠ” ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì·¨ì†Œ ì‹œ ë¹„ì›Œë‘ì„¸ìš”)");
    if (reason === null) {
        return false;
    }
    form.rejection_reason.value = reason;
    return confirm("ì •ë§ ì´ íœ´ê°€ ì‹ ì²­ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
}
</script>
{% endblock %}
