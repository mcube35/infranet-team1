{% extends "base.html" %}

{% block title %}ê·¼íƒœ ê´€ë¦¬{% endblock %}

{% block content %}
<h1>ğŸ“… ê·¼íƒœ ê´€ë¦¬ í˜ì´ì§€</h1>
<p><strong>{{ current_user.name }}</strong>ë‹˜ì˜ ê·¼íƒœ ê¸°ë¡ì…ë‹ˆë‹¤.</p>
<hr>

<!-- 1. ì¶œê·¼/í‡´ê·¼ ë²„íŠ¼ ì˜ì—­ -->
<div style="margin-bottom: 20px;">
    {% if not today_record or not today_record.clock_in %}
        <form action="{{ url_for('att.clock_in') }}" method="post" style="display: inline;">
            <button type="submit">ì¶œê·¼í•˜ê¸°</button>
        </form>
    {% elif not today_record.clock_out %}
        <form action="{{ url_for('att.clock_out') }}" method="post" style="display: inline;">
            <button type="submit">í‡´ê·¼í•˜ê¸°</button>
        </form>
    {% else %}
        <span>âœ… ì˜¤ëŠ˜ì€ ëª¨ë“  ê¸°ë¡ì„ ë§ˆì³¤ìŠµë‹ˆë‹¤.</span>
    {% endif %}
</div>


<h3>ë‚´ ê·¼íƒœ ê¸°ë¡</h3>

{% set flashed_messages = get_flashed_messages(with_categories=true) %}

<table border="1" style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="background-color: #f2f2f2;">
            <th style="padding: 8px;">ë‚ ì§œ</th>
            <th style="padding: 8px;">ì¶œê·¼ ì‹œê°„</th>
            <th style="padding: 8px;">í‡´ê·¼ ì‹œê°„</th>
            <th style="padding: 8px;">ì´ ê·¼ë¬´ ì‹œê°„</th>
            <th style="padding: 8px;">ìƒíƒœ</th>
            <th style="padding: 8px; width: 25%; min-width: 200px;">ë¹„ê³ </th>
        </tr>
    </thead>
    <tbody>
        {% for record in records %}
        <tr>
            <td style="text-align: center; padding: 8px;">{{ record.date }}</td>
            <td style="text-align: center; padding: 8px;">{{ record.clock_in }}</td>
            <td style="text-align: center; padding: 8px;">{{ record.clock_out }}</td>
            <td style="text-align: center; padding: 8px;">{{ record.working_time }}</td>
            <td style="text-align: center; padding: 8px;">
                {% if record.status == 'ì •ìƒ' %}<strong style="color: green;">âœ… ì •ìƒ</strong>
                {% elif record.status == 'ì§€ê°' %}<strong style="color: orange;">ğŸ•– ì§€ê°</strong>
                {% elif record.status == 'ê²°ê·¼' %}<strong style="color: red;">âŒ ê²°ê·¼</strong>
                {% else %}{{ record.status }}{% endif %}
            </td>
            <td>
                <form action="{{ url_for('att.save_memo', record_id=record._id, page=current_page, start_date=start_date, end_date=end_date) }}" method="post" style="display: flex; align-items: center;">
                    <input type="text" name="memo" value="{{ record.memo }}" placeholder="ë¹„ê³  ì…ë ¥..." style="flex-grow: 1; margin-right: 5px; border: 1px solid #ccc; padding: 4px; font-size: 0.9em;">
                    <button type="submit" title="ì €ì¥í•˜ê¸°" style="background:none; border:none; padding:0; cursor:pointer; font-size: 1.3em; margin-right: 5px;">ğŸ’¾</button>
                    {% for category, message in flashed_messages %}{% if message == 'saved_' + record._id|string %}<span style="color: green; font-weight: bold; font-size: 0.8em; margin-left: auto;">âœ… ì €ì¥ë¨</span>{% endif %}{% endfor %}
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6" style="text-align: center; padding: 20px;">í‘œì‹œí•  ê·¼íƒœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{# í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ì´ ì—¬ê¸°ì—ì„œ í•˜ë‹¨ìœ¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤. #}

<hr style="margin-top: 30px;">

<!-- ê¸°ê°„ë³„ ì¡°íšŒ í•„í„°ë§ ì˜ì—­ -->
<fieldset>
    <legend><strong>ê¸°ê°„ë³„ ì¡°íšŒ</strong></legend>
    <form method="GET" action="{{ url_for('att.show_list') }}" style="margin-top: 10px;">
        <label for="start_date">ì‹œì‘ ë‚ ì§œ:</label><input type="date" id="start_date" name="start_date" value="{{ start_date }}">
        <label for="end_date" style="margin-left: 10px;">ì¢…ë£Œ ë‚ ì§œ:</label><input type="date" id="end_date" name="end_date" value="{{ end_date }}">
        <button type="submit" style="margin-left: 10px;">ğŸ” í•„í„°ë§</button>
    </form>
</fieldset>

<!--  í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ì´ ì´ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.  -->
<div class="pagination" style="text-align: center; margin-top: 20px;">
    {% if total_pages > 0 %}
        {% if current_page > 1 %}<a href="{{ url_for('att.show_list', page=current_page - 1, start_date=start_date, end_date=end_date) }}" style="text-decoration: none; padding: 5px;">Â« ì´ì „</a>{% else %}<span style="color: grey; padding: 5px;">Â« ì´ì „</span>{% endif %}
        {% for page_num in range(1, total_pages + 1) %}{% if page_num == current_page %}<strong style="padding: 5px; color: black;">{{ page_num }}</strong>{% else %}<a href="{{ url_for('att.show_list', page=page_num, start_date=start_date, end_date=end_date) }}" style="text-decoration: none; padding: 5px;">{{ page_num }}</a>{% endif %}{% endfor %}
        {% if current_page < total_pages %}<a href="{{ url_for('att.show_list', page=current_page + 1, start_date=start_date, end_date=end_date) }}" style="text-decoration: none; padding: 5px;">ë‹¤ìŒ Â»</a>{% else %}<span style="color: grey; padding: 5px;">ë‹¤ìŒ Â»</span>{% endif %}
    {% endif %}
</div>

{% endblock %}