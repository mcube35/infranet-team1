{% extends "base.html" %}

{% block title %}ì§ì› ëª©ë¡ (ê´€ë¦¬ì){% endblock %}

{% block content %}
<h1>ğŸ‘¥ ì§ì› ëª©ë¡ (ê´€ë¦¬ììš©)</h1>

<p><a href="{{ url_for('emp_admin.employee_create_form') }}"><button type="button">â• ì‹ ê·œ ì§ì› ë“±ë¡</button></a></p>

<table border="1" cellpadding="5" cellspacing="0" style="width:100%; border-collapse: collapse;">
    <thead>
        <tr style="background-color: #f2f2f2;">
            <th style="width: 5%;">No.</th>
            <th style="width: 15%;">ì´ë¦„</th>
            <th>ë¶€ì„œ</th>
            <th>ì§ìœ„</th>
            <th>ì§ë¬´</th>
            <th>ì´ë©”ì¼</th>
            <th>ì…ì‚¬ì¼</th>
            <th>í‡´ì‚¬ì¼</th>
            <th style="width: 8%;">ìƒíƒœ</th>
            <th style="width: 10%;">ìˆ˜ì •</th>
        </tr>
    </thead>
    <tbody>
        {% if employees %}
            {% for employee in employees %}
            <tr>
                <td style="text-align: center;">{{ total_records - ((current_page - 1) * page_size) - loop.index0 }}</td>
                <td style="text-align: center;">
                    {% if employee.profile_image_id %}<img src="{{ url_for('file_download', file_id=employee.profile_image_id) }}" alt="." width="30" height="30" style="border-radius: 50%; vertical-align: middle; margin-right: 8px;">
                    {% else %}<span style="display: inline-block; width: 30px; height: 30px; background-color: #eee; border-radius: 50%; vertical-align: middle; margin-right: 8px;"></span>{% endif %}
                    {{ employee.name }}
                </td>
                <td>{{ employee.department }}</td>
                <td>{{ employee.position }}</td>
                <td>{{ employee.job_title or '-'}}</td>
                <td>{{ employee.email }}</td>
                <td style="text-align: center;">{{ employee.hire_date.strftime('%Y-%m-%d') if employee.hire_date else '-' }}</td>
                
                {# 2. 'í‡´ì‚¬ì¼' ë°ì´í„° í‘œì‹œ (ì¡°ê±´ë¶€) #}
                <td style="text-align: center;">
                    {% if employee.status == 'í‡´ì‚¬' and employee.updated_at %}
                        {{ employee.updated_at.strftime('%Y-%m-%d') }}
                    {% else %}
                        -
                    {% endif %}
                </td>

                <td style="text-align: center;">{{ employee.status }}</td>
                <td style="text-align: center;">
                    <a href="{{ url_for('emp_admin.employee_edit_form', employee_id=employee._id) }}" title="ìƒì„¸/ìˆ˜ì •" style="font-size: 1.2em; text-decoration: none;">âœï¸</a>
                    {% if employee.status in ['ì¬ì§ì¤‘', 'íœ´ì§'] %}
                    <form action="{{ url_for('emp_admin.employee_deactivate', employee_id=employee._id) }}" method="post" style="display: inline; margin-left: 10px;">
                        <button type="submit" title="ë¹„í™œì„±í™”(í‡´ì‚¬)" onclick="return confirm('ì •ë§ ì´ ì§ì›ì„ ë¹„í™œì„±í™”(í‡´ì‚¬ ì²˜ë¦¬)í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
                                style="background: none; border: none; padding: 0; cursor: pointer; font-size: 1.2em;">ğŸš«</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="9" style="text-align: center; padding: 20px;">
                {% if search_keyword or search_status or start_date or end_date %}ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                {% else %}ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.{% endif %}
            </td></tr>
        {% endif %}
    </tbody>
</table>

{# (ê²€ìƒ‰ í¼, í˜ì´ì§€ë„¤ì´ì…˜) #}
<fieldset style="margin-top: 20px; padding: 15px; border: 1px solid #ccc; background-color:#f9f9f9;"><legend><strong>ì§ì› ê²€ìƒ‰</strong></legend><div style="text-align: center;"><form method="GET" action="{{ url_for('emp_admin.employee_list') }}" style="display: inline-block;"><select name="search_category"><option value="name" {% if search_category == 'name' %}selected{% endif %}>ì´ë¦„</option><option value="department" {% if search_category == 'department' %}selected{% endif %}>ë¶€ì„œ</option><option value="position" {% if search_category == 'position' %}selected{% endif %}>ì§ìœ„</option></select><input type="text" name="search_keyword" placeholder="ê²€ìƒ‰ì–´" value="{{ search_keyword or '' }}" size="15"><label for="status" style="margin-left:10px;">ìƒíƒœ:</label><select name="status" id="status"><option value="">ì „ì²´</option><option value="ì¬ì§ì¤‘" {% if search_status == 'ì¬ì§ì¤‘' %}selected{% endif %}>ì¬ì§ì¤‘</option><option value="í‡´ì‚¬" {% if search_status == 'í‡´ì‚¬' %}selected{% endif %}>í‡´ì‚¬</option><option value="íœ´ì§" {% if search_status == 'íœ´ì§' %}selected{% endif %}>íœ´ì§</option></select><label for="start_date" style="margin-left:10px;">ì…ì‚¬ì¼:</label><input type="date" id="start_date" name="start_date" value="{{ start_date or '' }}"> ~ <input type="date" id="end_date" name="end_date" value="{{ end_date or '' }}"><button type="submit" style="margin-left:10px;">ğŸ” ê²€ìƒ‰</button><a href="{{ url_for('emp_admin.employee_list') }}"><button type="button">ğŸ”„ ì´ˆê¸°í™”</button></a></form></div></fieldset>
<div class="pagination" style="text-align: center; margin-top: 20px;">{% if total_pages > 0 %}{% set query_params = request.args.to_dict() %}{% if current_page > 1 %}{% set _ = query_params.update({'page': current_page - 1}) %}<a href="{{ url_for('emp_admin.employee_list', **query_params) }}" style="text-decoration: none; padding: 5px;">Â« ì´ì „</a>{% else %}<span style="color: grey; padding: 5px;">Â« ì´ì „</span>{% endif %}{% for page_num in range(1, total_pages + 1) %}{% if page_num == current_page %}<strong style="padding: 5px; color: black;">{{ page_num }}</strong>{% else %}{% set _ = query_params.update({'page': page_num}) %}<a href="{{ url_for('emp_admin.employee_list', **query_params) }}" style="text-decoration: none; padding: 5px;">{{ page_num }}</a>{% endif %}{% endfor %}{% if current_page < total_pages %}{% set _ = query_params.update({'page': current_page + 1}) %}<a href="{{ url_for('emp_admin.employee_list', **query_params) }}" style="text-decoration: none; padding: 5px;">ë‹¤ìŒ Â»</a>{% else %}<span style="color: grey; padding: 5px;">ë‹¤ìŒ Â»</span>{% endif %}{% endif %}</div>
{% endblock %}