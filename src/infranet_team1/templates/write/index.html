{% extends "base.html" %}

{% block title %}ê²Œì‹œê¸€ ëª©ë¡ - ì»¤ë®¤ë‹ˆí‹°{% endblock %}

{% block content %}
<div class="container" style="display: flex;">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°”: ì¹´í…Œê³ ë¦¬ -->
    <aside class="sidebar" style="width: 200px; padding: 10px; border-right: 1px solid #ddd;">
        <h3>ì¹´í…Œê³ ë¦¬</h3>
        <select id="categorySelect" style="width: 100%; padding: 5px;">
            <option value="{{ url_for('write.home') }}" {% if not request.args.get('category') %}selected{% endif %}>ì „ì²´ë³´ê¸°</option>
            <option value="{{ url_for('write.home', category='free') }}" {% if request.args.get('category') == 'free' %}selected{% endif %}>ììœ ê²Œì‹œíŒ</option>
            <option value="{{ url_for('write.home', category='qna') }}" {% if request.args.get('category') == 'qna' %}selected{% endif %}>ì§ˆë¬¸ê³¼ ë‹µë³€</option>
            <option value="{{ url_for('write.home', category='notice') }}" {% if request.args.get('category') == 'notice' %}selected{% endif %}>ê³µì§€ì‚¬í•­</option>
        </select>
    </aside>

<script>
    document.getElementById('categorySelect').addEventListener('change', function() {
        const url = this.value;
        window.location.href = url;
    });
</script>

    <!-- ì˜¤ë¥¸ìª½ ë©”ì¸ ì½˜í…ì¸  -->
    <main class="content" style="flex: 1; padding: 10px;">
        <h2>ê²Œì‹œê¸€ ëª©ë¡</h2>

        <form method="GET" action="{{ url_for('write.home') }}">
            <input type="text" name="q" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{ request.args.get('q', '') }}">
            <button type="submit">ê²€ìƒ‰</button>
            <!-- ì¹´í…Œê³ ë¦¬ ìœ ì§€í•˜ë ¤ë©´ íˆë“  í•„ë“œ ì¶”ê°€ -->
            {% if request.args.get('category') %}
            <input type="hidden" name="category" value="{{ request.args.get('category') }}">
            {% endif %}
        </form>

        {% if posts %}
        <ul class="post-list">
            {% for post in posts %}
            <li>
                <a href="{{ url_for('write.detail', post_id=post._id) }}">{{ post.title }}</a>
                <br>
                <small>
                    ğŸ“‚ ì¹´í…Œê³ ë¦¬:
                    {% if post.category == "notice" %}
                        ê³µì§€
                    {% elif post.category == "free" %}
                        ììœ 
                    {% elif post.category == "qna" %}
                        ì§ˆì˜ì‘ë‹µ
                    {% else %}
                        ê¸°íƒ€
                    {% endif %}
                    | âœï¸ {{ author_map[post.author_id] }}
                    | ğŸ•’ {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}
                </small>
            </li>
            {% endfor %}
        </ul>

        {% else %}
        <p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
        
        <!-- ê²Œì‹œê¸€ ëª©ë¡ í•˜ë‹¨ì— ìƒˆê¸€ ì‘ì„± ë²„íŠ¼ ì¶”ê°€ -->
        <div style="margin-top: 20px;">
            <a href="{{ url_for('write.write_form') }}" class="btn btn-primary">ìƒˆê¸€ ì‘ì„±í•˜ê¸°</a>
        </div>
    </main>
    <!-- í†µê³„ íŒ¨ë„ -->
    <section class="statistics" style="flex: 1; padding: 10px; background-color: #f9f9f9; border-left: 1px solid #ccc;">
        <h3>ğŸ“Š í™œë™ ìˆœìœ„</h3>
        <ul>
            {% for user_name, count in top_users %}
            <li>{{ user_name }} - {{ count }}íšŒ</li>
            {% endfor %}
        </ul>
    </section>
    </div>
</div>
{% endblock %}