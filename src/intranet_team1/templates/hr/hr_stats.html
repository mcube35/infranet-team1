{% extends "base.html" %}

{% block title %}
ì¸ì‚¬ í†µê³„ ëŒ€ì‹œë³´ë“œ
{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<h1>ğŸ“Š ì¸ì‚¬ í†µê³„ ëŒ€ì‹œë³´ë“œ</h1>
<p>íšŒì‚¬ ì „ì²´ì˜ ì¸ë ¥ í˜„í™©ì— ëŒ€í•œ ì£¼ìš” ì§€í‘œë¥¼ ì‹œê°í™”í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
<hr>

<fieldset style="margin-bottom: 20px;">
  <legend><strong>ì£¼ìš” í˜„í™©</strong></legend>
  <div style="padding: 15px; font-size: 1.1em; text-align: center;">
    <strong>ì´ ì§ì›:</strong> {{ total_employees }}ëª… Â |Â 
    <strong style="color: green;">ì¬ì§:</strong> {{ active_employees }}ëª… Â |Â 
    <strong style="color: orange;">íœ´ì§:</strong> {{ on_leave_employees }}ëª… Â |Â 
    <strong style="color: red;">í‡´ì‚¬:</strong> {{ resigned_employees }}ëª…
  </div>
</fieldset>

<style>
  .chart-row {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
  }

  .chart-row > div {
    flex: 1;
  }
</style>

<div class="chart-row">
  <div>
    <h3>ë¶€ì„œë³„ ë¶„í¬</h3>
    <canvas id="departmentChart" style="height:300px; width:100% "></canvas>
  </div>
  <div>
    <h3>ì§ê¸‰ë³„ ë¶„í¬</h3>
    <canvas id="positionChart" style="height:300px; width:100%"></canvas>
  </div>
  <div>
    <h3>ì§ì±…/ì§ë¬´ë³„ ë¶„í¬</h3>
    <canvas id="jobTitleChart" style="height:300px; width:100%"></canvas>
  </div>
</div>


<div class="chart-row">
    <div>
        <h3>ì¬ì§ì ê·¼ì† ì—°ìˆ˜</h3>
        <canvas id="yosActiveChart" style="height:300px; width:100%"></canvas>
    </div>
    <div>
        <h3>í‡´ì‚¬ì ê·¼ì† ì—°ìˆ˜</h3>
        <canvas id="resignedYosChart" style="height:300px; width:100%"></canvas>
    </div>
</div>

<div style="margin-bottom: 30px;">
  <h3>ì›”ë³„ ì…/í‡´ì‚¬ í˜„í™© (ìµœê·¼ 12ê°œì›”)</h3>
  <canvas id="hireResignChart" style="height:300px; width:100%"></canvas>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const barChartOptions = {
    responsive: false,
    maintainAspectRatio: false,
    plugins: { legend: { display: false } },
    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
  };

  const lineChartOptions = {
    responsive: false,
    maintainAspectRatio: false,
    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
  };

  const doughnutChartOptions = {
    responsive: false,
    maintainAspectRatio: false
  };

  const colors = {
    department: 'rgba(54, 162, 235, 0.6)',
    position: 'rgba(75, 192, 192, 0.6)',
    job_title: 'rgba(255, 206, 86, 0.6)',
    resigned_yos: 'rgba(255, 99, 132, 0.6)',
    hires: 'rgba(54, 162, 235, 1)',
    resignations: 'rgba(255, 99, 132, 1)',
    yos_active: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99']
  };

  async function renderChart(canvasId, apiUrl, chartType, color, options) {
    const ctx = document.getElementById(canvasId);
    if (!ctx) return;
    const response = await fetch(apiUrl);
    const chartData = await response.json();
    new Chart(ctx, {
      type: chartType,
      data: {
        labels: chartData.labels,
        datasets: [{
          label: 'ì§ì› ìˆ˜',
          data: chartData.data,
          backgroundColor: color,
          borderColor: color,
          borderWidth: 1
        }]
      },
      options: options
    });
  }

  async function renderComboChart(canvasId, apiUrl, options) {
    const ctx = document.getElementById(canvasId);
    if (!ctx) return;
    const response = await fetch(apiUrl);
    const chartData = await response.json();
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: chartData.labels,
        datasets: [
          {
            type: 'line',
            label: chartData.datasets[0].label,
            data: chartData.datasets[0].data,
            borderColor: colors.hires,
            backgroundColor: colors.hires,
            tension: 0.1
          },
          {
            type: 'line',
            label: chartData.datasets[1].label,
            data: chartData.datasets[1].data,
            borderColor: colors.resignations,
            backgroundColor: colors.resignations,
            tension: 0.1
          }
        ]
      },
      options: options
    });
  }

  renderChart('departmentChart', '/hr/stats/api/chart-data/department', 'bar', colors.department, barChartOptions);
  renderChart('positionChart', '/hr/stats/api/chart-data/position', 'bar', colors.position, barChartOptions);
  renderChart('jobTitleChart', '/hr/stats/api/chart-data/job_title', 'bar', colors.job_title, barChartOptions);
  renderChart('yosActiveChart', '/hr/stats/api/chart-data/yos_active', 'doughnut', colors.yos_active, doughnutChartOptions);
  renderChart('resignedYosChart', '/hr/stats/api/chart-data/yos_resigned', 'bar', colors.resigned_yos, barChartOptions);
  renderComboChart('hireResignChart', '/hr/stats/api/chart-data/hires_vs_resignations', lineChartOptions);
});
</script>

{% endblock %}
